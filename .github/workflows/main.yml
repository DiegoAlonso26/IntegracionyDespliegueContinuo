name: Docker Deploy Local (Self-Hosted)

on:
  push:
    branches:
      - main  # Se activa solo cuando haces push a la rama main

jobs:
  deploy:
    runs-on: self-hosted  # Usa tu runner local (en tu PC)

    steps:
    - name: ğŸ§¾ Paso 1 - Descargar cÃ³digo del repo
      uses: actions/checkout@v3

    - name: ğŸ§¹ Paso 2 - Mostrar archivos descargados
      run: |
        echo "Archivos descargados en el runner:"
        ls -la

    - name: ğŸ³ Paso 3 - Apagar contenedores anteriores
      run: |
        echo "â¤ Ejecutando docker compose down..."
        docker compose down

    - name: ğŸ§± Paso 4 - Construir contenedor
      run: |
        echo "â¤ Ejecutando docker compose build..."
        docker compose build

    - name: ğŸš€ Paso 5 - Levantar contenedor
      run: |
        echo "â¤ Ejecutando docker compose up..."
        docker compose up -d

    - name: âœ… Paso 6 - Verificar contenedores activos
      run: |
        echo "â¤ Contenedores en ejecuciÃ³n:"
        docker ps
